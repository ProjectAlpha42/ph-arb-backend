<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PH Arbitrage Dashboard</title>
  <style>
    :root {
      color-scheme: dark;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050814;
      color: #e5e7eb;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      padding: 16px 24px;
      background: #020617;
      border-bottom: 1px solid #1f2933;
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
    }
    header h1 {
      margin: 0;
      font-size: 1.3rem;
      color: #60a5fa;
    }
    header .badges span {
      display: inline-block;
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 999px;
      margin-right: 6px;
      border: 1px solid #1f2933;
    }
    .badge-free {
      background: #022c22;
      color: #6ee7b7;
      border-color: #064e3b;
    }
    .badge-pro {
      background: #1e1b4b;
      color: #a855f7;
      border-color: #4c1d95;
    }
    main {
      flex: 1;
      padding: 16px;
      max-width: 960px;
      width: 100%;
      margin: 0 auto;
    }
    #last-updated {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 12px;
    }
    .card {
      background: #020617;
      border-radius: 12px;
      border: 1px solid #1f2933;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.55);
    }
    .card h2 {
      margin: 0 0 8px 0;
      font-size: 1rem;
      color: #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .pill {
      font-size: 0.7rem;
      padding: 3px 7px;
      border-radius: 999px;
      background: #111827;
      color: #9ca3af;
      border: 1px solid #374151;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      margin-top: 8px;
    }
    th, td {
      padding: 6px 4px;
      text-align: right;
      border-bottom: 1px solid #111827;
    }
    th:first-child, td:first-child {
      text-align: left;
    }
    th {
      font-weight: 500;
      color: #9ca3af;
      background: #020617;
    }
    tr:last-child td {
      border-bottom: none;
    }
    .pos {
      color: #22c55e;
      font-weight: 600;
    }
    .neg {
      color: #f97373;
      font-weight: 600;
    }
    .muted {
      color: #6b7280;
    }
    #error {
      color: #f97373;
      font-size: 0.85rem;
      margin-bottom: 8px;
    }
    footer {
      padding: 10px 16px;
      font-size: 0.75rem;
      color: #6b7280;
      text-align: center;
      border-top: 1px solid #111827;
      background: #020617;
    }
    @media (max-width: 640px) {
      header {
        padding: 12px 12px;
      }
      main {
        padding: 12px;
      }
      table {
        font-size: 0.8rem;
      }
      th, td {
        padding: 5px 3px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>ðŸ‡µðŸ‡­ PH Arbitrage Dashboard</h1>
      <div id="last-updated">Checking latest data...</div>
    </div>
    <div class="badges">
      <span class="badge-free">Free tier: delayed data</span>
      <span class="badge-pro">Pro tier: live data (coming soon)</span>
    </div>
  </header>

  <main>
    <div id="error"></div>

    <div class="card" id="free-card">
      <h2>
        Free Snapshot
        <span class="pill">Uses free_data.json</span>
      </h2>
      <table>
        <thead>
          <tr>
            <th>Source</th>
            <th>Buy (â‚±)</th>
            <th>Sell (â‚±)</th>
            <th>Official USDâ†’PHP</th>
            <th>Spread (Buy%)</th>
            <th>Spread (Sell%)</th>
          </tr>
        </thead>
        <tbody id="free-body">
          <tr><td colspan="6" class="muted">Loadingâ€¦</td></tr>
        </tbody>
      </table>
    </div>

    <div class="card" id="pro-card">
      <h2>
        Pro Snapshot
        <span class="pill">Uses pro_data.json</span>
      </h2>
      <table>
        <thead>
          <tr>
            <th>Source</th>
            <th>Buy (â‚±)</th>
            <th>Sell (â‚±)</th>
            <th>Official USDâ†’PHP</th>
            <th>Spread (Buy%)</th>
            <th>Spread (Sell%)</th>
          </tr>
        </thead>
        <tbody id="pro-body">
          <tr><td colspan="6" class="muted">Loadingâ€¦</td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <footer>
    Auto-refreshes every 60 seconds Â· Data from Binance P2P + Official FX Â·
    Pro access / login can be added on top of this layout later.
  </footer>

  <script>
    const errorBox = document.getElementById("error");
    const lastUpdated = document.getElementById("last-updated");
    const freeBody = document.getElementById("free-body");
    const proBody = document.getElementById("pro-body");

    async function fetchJson(path) {
      const url = path + "?" + Date.now(); // bust cache
      const res = await fetch(url);
      if (!res.ok) {
        throw new Error(`HTTP ${res.status}`);
      }
      return res.json();
    }

    function renderRow(data) {
      const rates = data.rates || {};
      const spreads = data.spreads_pct || {};
      const p2p = rates.binance_p2_php_per_usdt || {};
      const official = rates.official_usd_php;

      const buy = p2p.buy_usdt ?? 0;
      const sell = p2p.sell_usdt ?? 0;
      const buySpread = spreads.buy_usdt_vs_official_usd_to_php ?? 0;
      const sellSpread = spreads.sell_usdt_vs_official_usd_to_php ?? 0;

      return `
        <tr>
          <td>Binance P2P</td>
          <td>${buy.toFixed(3)}</td>
          <td>${sell.toFixed(3)}</td>
          <td>${official != null ? official.toFixed(3) : "-"}</td>
          <td class="${buySpread >= 0 ? "pos" : "neg"}">
            ${buySpread.toFixed(3)}%
          </td>
          <td class="${sellSpread >= 0 ? "pos" : "neg"}">
            ${sellSpread.toFixed(3)}%
          </td>
        </tr>`;
    }

    async function refresh() {
      try {
        errorBox.textContent = "";
        // Fetch both free and pro in parallel
        const [freeData, proData] = await Promise.all([
          fetchJson("/data/free_data.json"),
          fetchJson("/data/pro_data.json"),
        ]);

        freeBody.innerHTML = renderRow(freeData);
        proBody.innerHTML = renderRow(proData);

        const ts = proData.as_of || freeData.as_of || "unknown";
        lastUpdated.textContent = "Last updated: " + ts + " (UTC)";
      } catch (err) {
        console.error(err);
        errorBox.textContent =
          "Error loading data from server. Please refresh or try again in a moment.";
      }
    }

    refresh();
    setInterval(refresh, 60_000);
  </script>
</body>
</html>
