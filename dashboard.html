<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PH Arbitrage Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: radial-gradient(circle at top left, #111827 0, #020617 45%, #000 100%);
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .card {
      background: radial-gradient(circle at top left, rgba(148,163,184,0.18), rgba(15,23,42,0.95));
      border-radius: 1rem;
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 20px 40px rgba(15,23,42,0.8);
    }
    .pill {
      border-radius: 9999px;
      padding: 0.15rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 500;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.9);
    }
    .label-pill {
      border-radius: 9999px;
      padding: 0.15rem 0.6rem;
      font-size: 0.7rem;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.9);
    }
    .table-row {
      border-radius: 0.75rem;
    }
    .table-row td:first-child {
      border-top-left-radius: 0.75rem;
      border-bottom-left-radius: 0.75rem;
    }
    .table-row td:last-child {
      border-top-right-radius: 0.75rem;
      border-bottom-right-radius: 0.75rem;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="w-full border-b border-slate-800/80 bg-slate-950/70 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div>
        <div class="text-xs font-semibold tracking-wide text-sky-400">PH</div>
        <h1 class="text-xl font-semibold text-slate-50">
          PH Arbitrage Dashboard
        </h1>
        <p id="last-updated" class="text-xs text-slate-400 mt-1">
          Last updated: –
        </p>
      </div>
      <div class="flex items-center gap-2">
        <span class="pill text-emerald-300/90 bg-emerald-950/40 border-emerald-500/50">
          Free tier: delayed data
        </span>
        <span class="pill text-violet-300/90 bg-violet-950/40 border-violet-500/50">
          Pro tier: live data (coming soon)
        </span>
      </div>
    </div>
  </header>

  <main class="flex-1 w-full">
    <div class="max-w-6xl mx-auto px-4 py-8 space-y-6">

      <!-- Free Snapshot -->
      <section class="card p-5 md:p-6">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-slate-50 font-semibold text-lg">Free Snapshot</h2>
            <p class="text-xs text-slate-400 mt-1">
              Uses delayed data from <span class="font-medium">free_data.json</span>
            </p>
          </div>
          <span class="label-pill text-sky-300 border-sky-500/60">
            Uses free_data.json
          </span>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-slate-400 text-xs border-b border-slate-800/80">
              <tr>
                <th class="text-left py-2 pr-4 font-medium">Source</th>
                <th class="text-right py-2 px-4 font-medium">Buy (₱)</th>
                <th class="text-right py-2 px-4 font-medium">Sell (₱)</th>
                <th class="text-right py-2 px-4 font-medium">Official USD→PHP</th>
                <th class="text-right py-2 px-4 font-medium">Spread (Buy%)</th>
                <th class="text-right py-2 pl-4 font-medium">Spread (Sell%)</th>
              </tr>
            </thead>
            <tbody id="free-row" class="text-slate-100">
              <tr class="table-row bg-slate-900/60">
                <td class="py-3 pr-4 text-slate-200">Binance P2P</td>
                <td class="py-3 px-4 text-right">0.000</td>
                <td class="py-3 px-4 text-right">0.000</td>
                <td class="py-3 px-4 text-right">0.000</td>
                <td class="py-3 px-4 text-right text-emerald-400">0.000%</td>
                <td class="py-3 pl-4 text-right text-emerald-400">0.000%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Pro Snapshot -->
      <section class="card p-5 md:p-6">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-slate-50 font-semibold text-lg">Pro Snapshot</h2>
            <p class="text-xs text-slate-400 mt-1">
              Uses live data from <span class="font-medium">pro_data.json</span>
            </p>
          </div>
          <span class="label-pill text-violet-300 border-violet-500/60">
            Uses pro_data.json
          </span>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-slate-400 text-xs border-b border-slate-800/80">
              <tr>
                <th class="text-left py-2 pr-4 font-medium">Source</th>
                <th class="text-right py-2 px-4 font-medium">Buy (₱)</th>
                <th class="text-right py-2 px-4 font-medium">Sell (₱)</th>
                <th class="text-right py-2 px-4 font-medium">Official USD→PHP</th>
                <th class="text-right py-2 px-4 font-medium">Spread (Buy%)</th>
                <th class="text-right py-2 pl-4 font-medium">Spread (Sell%)</th>
              </tr>
            </thead>
            <tbody id="pro-row" class="text-slate-100">
              <tr class="table-row bg-slate-900/60">
                <td class="py-3 pr-4 text-slate-200">Binance P2P</td>
                <td class="py-3 px-4 text-right">0.000</td>
                <td class="py-3 px-4 text-right">0.000</td>
                <td class="py-3 px-4 text-right">0.000</td>
                <td class="py-3 px-4 text-right text-emerald-400">0.000%</td>
                <td class="py-3 pl-4 text-right text-emerald-400">0.000%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

  <footer class="w-full border-t border-slate-800/80 bg-slate-950/80">
    <div class="max-w-6xl mx-auto px-4 py-3 text-[11px] text-slate-500 flex flex-wrap items-center justify-between gap-2">
      <div>
        Auto-refreshes every <span class="font-semibold">60 seconds</span> ·
        Data from Binance P2P + official FX
      </div>
      <div>
        Pro access / login can be layered on top of this layout later.
      </div>
    </div>
  </footer>

  <script>
    async function fetchJsonSafe(url) {
      try {
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        return await res.json();
      } catch (err) {
        console.error("Error fetching", url, err);
        return null;
      }
    }

    function formatNumber(num, decimals = 3) {
      if (num === null || num === undefined || isNaN(num)) return "0.000";
      return Number(num).toFixed(decimals);
    }

    function formatPercent(num) {
      if (num === null || num === undefined || isNaN(num)) return "0.000%";
      return Number(num).toFixed(3) + "%";
    }

    function updateRow(rowId, data) {
      if (!data) return;

      const row = document.getElementById(rowId);
      if (!row) return;

      // Try to be flexible with key names
      const source = data.source || "Binance P2P";
      const buyPhp = data.buy_price_php ?? data.buy_php ?? data.buy ?? 0;
      const sellPhp = data.sell_price_php ?? data.sell_php ?? data.sell ?? 0;
      const fxRate = data.official_usd_php ?? data.fx_rate ?? 0;
      const buySpread = data.buy_spread_pct ?? data.spread_buy_pct ?? data.spread_buy ?? 0;
      const sellSpread = data.sell_spread_pct ?? data.spread_sell_pct ?? data.spread_sell ?? 0;

      row.innerHTML = `
        <tr class="table-row bg-slate-900/60">
          <td class="py-3 pr-4 text-slate-200">${source}</td>
          <td class="py-3 px-4 text-right">${formatNumber(buyPhp, 3)}</td>
          <td class="py-3 px-4 text-right">${formatNumber(sellPhp, 3)}</td>
          <td class="py-3 px-4 text-right">${formatNumber(fxRate, 3)}</td>
          <td class="py-3 px-4 text-right ${buySpread >= 0 ? 'text-emerald-400' : 'text-rose-400'}">
            ${formatPercent(buySpread)}
          </td>
          <td class="py-3 pl-4 text-right ${sellSpread >= 0 ? 'text-emerald-400' : 'text-rose-400'}">
            ${formatPercent(sellSpread)}
          </td>
        </tr>
      `;
    }

    function updateLastUpdated(freeData, proData) {
      const el = document.getElementById("last-updated");
      if (!el) return;

      const ts = freeData?.timestamp_utc || freeData?.timestamp || proData?.timestamp_utc || proData?.timestamp;
      if (!ts) {
        el.textContent = "Last updated: –";
        return;
      }

      try {
        const d = new Date(ts);
        const formatted = d.toISOString().replace("T", " ").replace("Z", "");
        el.textContent = `Last updated: ${formatted} UTC (UTC)`;
      } catch {
        el.textContent = `Last updated: ${ts} (UTC)`;
      }
    }

    async function refreshDashboard() {
      const [freeData, proData] = await Promise.all([
        fetchJsonSafe("free_data.json"),
        fetchJsonSafe("pro_data.json"),
      ]);

      if (freeData) updateRow("free-row", freeData);
      if (proData) updateRow("pro-row", proData);
      updateLastUpdated(freeData, proData);
    }

    // Initial load + auto-refresh
    refreshDashboard();
    setInterval(refreshDashboard, 60_000);
  </script>
</body>
</html>
